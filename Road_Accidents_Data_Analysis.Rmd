---
title: "Road accidents data analysis"
author: "Ahmed A. Radhi, Khalid Talal Suliman"
date: "3/13/2021"
output: html_document
---

```{r}

packages <- c("tidyverse", "leaflet","sf")
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

library(tidyverse)
library(leaflet)
library(sf)
```

# Task 1

```{r}
# Loading the data into R 
Accidents_2017 <- read_csv("Data/datagov-uk-6efe5505-941f-45bf-b576-4c1e09b579a1/2017-8.csv", 
col_names = c("Reference_Number","Easting","Northing","Vehicles_Num","Accident_Date","Time","Road_Class","Road_Surface",
              "Lightning_Cond","Weather_Cond","Vehicle_Type","Casualty_Class","Severity","Gender","Age"), skip = 1)

# Parsing the data
Accidents_Date <- Accidents_2017$Accident_Date
Accidents_Date <- parse_date(Accidents_Date, "%m/%d/%Y")

Time <- Accidents_2017$Time
Time <- parse_time(Time, "%H%M")

# Adding the new columns to the tibble.
Accidents_2017 <- Accidents_2017 %>%
  select(1:4, 7:15) %>%
  mutate(Accidents_Date, Time) 

Accidents_2017 <- Accidents_2017[,c(1:4,14,15,5:13)]

```

```{r}
str(Accidents_2017)
```


We have 2,203 observations, 15 variables (with `Age` and `Road_Surface` as examples of continuous and categorical variables, respectively), and we have times and dates in the `Accidents_Date` and `Time` variables. This satisfies the data requirements for the MATH 214 project.

## Description 
The dataset shows information on road accidents across Leeds during the year 2017.

 Reference_Number : Reference number of the accident (character)
 
 Easting          : X-coordinate of the location of the accident                         using grid coordinates (double)
 
 Northing         : Y-coordinate of the location of the accident                         using grid coordinates (double)
 
 Vehicles_Num     : Number of vehicles involved in the accident                          (double)
 
 Accident_Date    : Date of the accident (character)
 
 Time             : Time of the accident (double)
 
 Road_Class       : Class of road on which the accident happened                         (character)
 
 Road_Surface     : Surface of the road during the accident                              (character)
 
 Lightning_Cond   : Light conditions during the accident
                     (character)
                     
 Weather_Cond     : Weather conditions during the accident 
                     (character)
                     
 Vehicle_Type     : Type of vehicle that caused the accident
                     (character)
                     
 Casualty_Class   : Class of the casualty (character)
 
 Severity         : Degree of severity of the accident (character)
 
 Gender           : Gender of the driver (character)
 
 Age              : Age of the driver (double)

## Reference 
https://data.world/datagov-uk/6efe5505-941f-45bf-b576-4c1e09b579a1

# Task 2

```{r}
# Variance (Age)

ggplot(data = Accidents_2017, mapping= aes(x=Age)) +
  geom_histogram(binwidth = 1,fill="black", color = "white") 

Accidents_2017 %>%
  group_by(Age) %>%
  summarise(count = n())

```

```{r}
# Variance (Gender)

ggplot(data = Accidents_2017, mapping = aes(x=Gender)) + 
  geom_bar(fill = "black" , width = 0.5)

Accidents_2017 %>%
  group_by(Gender) %>%
  summarise(count = n())
```


```{r}
# Variance (Number of Accidents Per Month)

Accidents_2017 %>%
  group_by(Accidents_Date) %>%
  summarise(sum = n())

( Accidents_by_month <- 
    Accidents_2017 %>%
    mutate(month = format(Accidents_Date,"%m")) %>%
    group_by(month) %>%
    summarise(accidents_num = n())
)

ggplot(data = Accidents_by_month, mapping = aes(x = month, y = accidents_num)) +
  geom_bar(aes(fill = month) , show.legend = F, stat = "identity")

```


```{r}

# Covariance (Age/Gender against Count)

Accidents_2017 %>%
  group_by(Gender, Age) %>%
  summarise(count = n() ) %>%
  ungroup() %>%
  ggplot(mapping = aes(x=Age , y = count)) +
  geom_boxplot(aes(color = Gender))

```



```{r}

long_lat <- Accidents_2017 %>%
  st_as_sf(coords = c("Easting", "Northing"), crs = 27700) %>%
  st_transform(4326) %>%
  st_coordinates() %>%
  as_tibble()

long_lat_FULL <- Accidents_2017 %>%
  mutate(long_lat)  %>%
  select(Reference_Number, X, Y, Severity)
  
pal <- colorFactor(c("yellow", "orange", "red"), domain = c("Slight", "Serious", "Fatal"))
                   
leaflet(data = long_lat_FULL)%>%
  addTiles() %>%
  addCircleMarkers(lng = ~X, lat = ~Y, 
                   color = ~pal(Severity),
                   stroke = F, fillOpacity = 0.75,
                   clusterOptions = markerClusterOptions())  %>%
  addLegend(colors = c("yellow", "orange", "red") , labels = c("Slight", "Serious", "Fatal"))
  
             
```



```{r}
# Variance (Road Surface)
ggplot(data = Accidents_2017) +
  geom_bar(mapping = aes(x = Road_Surface))
```

Most accidents happen when the road is dry which is expected as drivers take more care when the road is bad. It is important to note that when the road is snowy, the number of accidents is extremely low compared to other settings(only 5 accidents).

```{r}
Accidents_2017 %>%
  group_by(Road_Surface) %>%
  summarise(count = n())
```

```{r}
# Variance (Casualty_Class )
Accidents_2017 %>%
  group_by(Casualty_Class) %>%
  summarise(count = n())

```


```{r}
# Covariance (Time and Severity)
ggplot(data = Accidents_2017)+ 
  geom_boxplot(mapping = aes(x = reorder(Severity, Time, FUN = median), y = Time))+ coord_flip()+
  ggtitle("Severity against Time")+
ylab("Severity")+
  xlab("Time")
```

Most serious and slight accidents happen between 10 am and 17.30 pm. While most fatal accidents occur between 16 pm and 22 pm. Serious accidents have the widest inter-quartile range while fatal accidents have the smallest inter=quartile range.   


```{r}
# Covariance(Age and Severity)
ggplot(data = Accidents_2017)+ 
  geom_boxplot(mapping = aes(x = reorder(Severity, Age, FUN = median), y = Age))+ coord_flip()+
  ggtitle("Severity against Age")+
ylab("Age")+
  xlab("Severity")
```

Fatal accidents tend to happen to people under the age of 25 more frequently.Slight accidents have a few outliers. Serious accidents have the widest inter-quartile range.

```{r}
Accidents_2017 %>%
  group_by(Severity) %>%
  summarise(count = n())

```

```{r}
Accidents_2017 %>%
  group_by(Weather_Cond) %>%
  summarise(count = n())
```

```{r}
# Variance (Time)
ggplot(Accidents_2017,mapping=aes(x=Time))+
geom_histogram(binwidth = 2000)+
  ggtitle("Accidents against Time")+
ylab("Number of Accidents")+
  xlab("Time")
```



The number of accidents that happen between 12 am and 7 am are low.
Generally, after 7 am as the time increases the number of accidents increase till 6 pm. After 6 pm the number of accidents decrease. There are 2 low drops which might represent something. 

# Questions

1. What are the worst conditions to drive in ?
2. What season has the most accidents ?
3. What is the worst time to drive at ?
4. Which area in Leeds has the most accidents ?
5. Which roads are the most dangerous ?


